pipeline {
	agent any
	
	stages {
		stage('Github checkout') {
			steps {
				script {
					git credentialsId: '<GitHub-login>',
					url: 'git@github.com:tamnguyen21/quest.git ',
					branch: 'main'
				}
			}
		}
		stage("node image"){
			agent{
				docker{
					image "node:lts-bullseye"
					args '''
				-v $HOME/.m2:/root/.m2
				-v root
			'''
					reuseNode true
				}
			}
			steps{
			    
				
				dir('ANGULAR/quest-angular'){
					sh "npm install"
					sh "./node_modules/.bin/ng build"
					
				}
			}
			
				
					
				
			
		}
		stage('Docker Build'){
			steps{
				dir('ANGULAR/quest-angular'){
				    sh '''
            export DOCKER_BUILDKIT=1
            docker build -t ajc/quest:angular .
            '''
				}
			}
		}
		stage("Docker Deploy"){
			steps{
				dir('DOCKER/commandes/compose/quest'){
					sh "docker compose up -d angular"
				}
			}
		}
	}
}